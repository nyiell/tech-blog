sequenceDiagram
    participant User
    participant OCM as OCM Control Plane
    participant HA as Hydration Agent (Ephemeral Instance)
    participant AWS as AWS Account
    participant OCI as OCI Block Storage

    User->>OCM: Start Replication
    OCM->>OCI: Create block volumes (matched to AWS sizes)
    OCM->>OCM: Spin up Hydration Agent
    OCM->>HA: Attach prepared volumes
    OCM->>HA: Pass AWS credentials & task

    HA->>AWS: CreateSnapshot(EC2 Volume)
    AWS-->>HA: Snapshot ID
    HA->>AWS: Poll until snapshot ready
    AWS-->>HA: Snapshot ready

    loop For each block
        HA->>AWS: GetSnapshotBlocks(range)
        AWS-->>HA: Block data
        HA->>OCI: Write blocks to mounted volume
    end

    HA->>OCM: Replication complete
    OCM->>OCM: Tag volume as "golden" (g_volume_identifier)
    OCM->>HA: Terminate hydration agent

    Note over OCI: Golden volumes remain for future launches
